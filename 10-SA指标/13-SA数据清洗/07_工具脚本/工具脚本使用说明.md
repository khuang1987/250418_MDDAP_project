# 工具脚本使用说明

## 📁 工具脚本目录

本目录包含SA数据清洗项目的所有批处理工具脚本，用于快速运行各种ETL和测试任务。

## 🚀 可用脚本

### 1. run_all_etl_ps.bat ⭐ **推荐**
**功能**: 运行完整的ETL流程 (PowerShell版本)
**执行顺序**: SAP路由 → SFC批次 → MES批次
**使用场景**: 
- 完整的数据处理流程
- 定期批量更新
- 首次运行或全量刷新
**优势**: 解决中文路径编码问题，更稳定

```bash
# 双击运行或命令行执行
run_all_etl_ps.bat
```

### 2. run_all_etl.bat
**功能**: 运行完整的ETL流程 (传统版本)
**注意**: 可能在中文路径环境下有问题

### 3. run_etl.bat
**功能**: 仅运行MES批次数据处理
**依赖**: 需要先运行SFC数据处理

### 4. run_sap_routing_ps.bat ⭐ **推荐**
**功能**: 仅运行SAP路由标准时间转换 (PowerShell版本)
**优势**: 解决中文路径编码问题

### 5. run_sap_routing.bat
**功能**: 仅运行SAP路由标准时间转换 (传统版本)

### 6. run_sfc_batch.bat
**功能**: 仅运行SFC批次报工数据处理

### 7. run_tests.bat
**功能**: 运行测试验证脚本
**包含测试**:
- 工序清洗测试
- MES结果验证
- PT计算测试
- 超期逻辑测试
- 完整逻辑验证

## 📋 使用指南

### 推荐使用方式

#### 日常数据处理
1. 使用 `run_all_etl.bat` 进行完整流程
2. 检查 `06_日志文件` 中的运行日志
3. 验证 `05_数据文件` 中的输出结果

#### 单独模块处理
1. **SAP数据更新**: 使用 `run_sap_routing.bat`
2. **SFC数据更新**: 使用 `run_sfc_batch.bat`
3. **MES数据更新**: 使用 `run_etl.bat`

#### 测试验证
1. 使用 `run_tests.bat` 运行所有测试
2. 或进入 `02_测试验证脚本` 目录运行单独测试

### 快速导航

使用根目录的 `快速导航.bat` 可以：
- 快速打开各个功能目录
- 直接启动ETL脚本
- 运行测试脚本
- 查看文档说明

## ⚠️ 注意事项

### 运行环境
- 确保Python虚拟环境已激活
- 确保所有依赖包已安装 (`requirements.txt`)
- 确保数据文件路径正确

### 数据依赖
- MES处理依赖SFC数据
- 建议按顺序执行: SAP → SFC → MES
- 单独运行MES时SFC数据可能不是最新的

### 错误处理
- 脚本包含错误检查，任一步骤失败会停止执行
- 错误信息会显示在控制台
- 详细日志保存在 `06_日志文件` 目录

### 性能考虑
- 完整流程可能需要较长时间
- 大数据量时建议在非工作时间运行
- 可根据需要调整配置文件中的参数

## 🔧 自定义配置

### 修改执行顺序
编辑 `run_all_etl.bat` 文件，调整步骤顺序

### 添加新脚本
1. 创建新的 `.bat` 文件
2. 遵循现有的路径切换模式
3. 添加适当的错误处理

### 修改参数
编辑 `03_配置文件` 目录中的YAML配置文件

## 📞 技术支持

如遇到问题：
1. 检查 `06_日志文件` 中的错误日志
2. 运行相关测试脚本进行诊断
3. 查看 `04_报告文档` 中的技术文档
4. 联系系统管理员

---

**更新时间**: 2025-11-21  
**版本**: v1.0  
**维护人员**: 请根据实际情况更新此文档
